<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fourier Series: Building a Square Wave</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .panels-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .panel {
            background: #fafafa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
        }

        .panel-title {
            font-weight: 600;
            color: #555;
            margin-bottom: 10px;
            font-size: 0.95em;
            text-align: center;
        }

        canvas {
            width: 100%;
            height: 200px;
            border-radius: 5px;
            background: white;
        }

        .main-canvas {
            height: 300px;
        }

        .controls {
            background: #f5f5f5;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 0.95em;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            border: none;
        }

        .value-display {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: 500;
            margin-left: 10px;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
        }

        .harmonics-display {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .harmonics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .harmonic-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #a8e6cf, #dcedc1);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9em;
        }

        .harmonic-label {
            font-weight: 600;
            color: #333;
        }

        .harmonic-amplitude {
            color: #666;
            font-family: 'Courier New', monospace;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 30px;
            height: 3px;
            border-radius: 2px;
        }

        .info-box {
            background: #f0f7ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 8px;
            margin-top: 25px;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-box p {
            color: #555;
            line-height: 1.6;
        }

        .equation {
            text-align: center;
            font-size: 1.1em;
            color: #333;
            margin: 15px 0;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
        }

        @media (max-width: 968px) {
            .panels-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 1.5em;
            }
            
            canvas {
                height: 150px;
            }
            
            .main-canvas {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1> Fourier Series: Building a Square Wave</h1>
        <p class="subtitle">See how sine waves add together to create a square wave!</p>
        
        <div class="controls">
            <div class="control-group">
                <label>
                    Number of Harmonics: 
                    <span class="value-display" id="harmonicsValue">1</span>
                </label>
                <input type="range" id="harmonicsSlider" min="1" max="10" value="1" step="1">
            </div>
            
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="showTarget" checked>
                    <label for="showTarget">Show Target Square Wave</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="showGrid" checked>
                    <label for="showGrid">Show Grid</label>
                </div>
            </div>
        </div>

        <div class="equation" id="equation">
            f(x) = (4/π) × [sin(x)]
        </div>
        
        <div class="panels-container">
            <div class="panel">
                <div class="panel-title">Step 1: Unit Amplitude Harmonics</div>
                <canvas id="harmonicsCanvas"></canvas>
            </div>
            
            <div class="panel">
                <div class="panel-title">Step 2: Scaled by Series Coefficients</div>
                <canvas id="scaledCanvas"></canvas>
            </div>
        </div>
        
        <div class="panel">
            <div class="panel-title">Final Result: Sum of All Components</div>
            <canvas id="mainCanvas" class="main-canvas"></canvas>
        </div>
        
        <div class="harmonics-display">
            <strong>Fourier Series Coefficients:</strong>
            <div class="harmonics-grid" id="harmonicsList"></div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #FF6B6B;"></div>
                <span>Fourier Sum</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4ECDC4;"></div>
                <span>Target Square Wave</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: rgba(150, 150, 150, 0.5);"></div>
                <span>Individual Components</span>
            </div>
        </div>
        
        <div class="info-box">
            <h3>Understanding the Process:</h3>
            <p>
                <strong>Step 1:</strong> We start with unit amplitude sine waves at odd harmonics (1, 3, 5, 7...). Each has frequency n×f where n is odd, since the square wave is an odd function: f(-x) = -f(x).<br><br>
                <strong>Step 2:</strong> We multiply each harmonic by its Fourier coefficient (4/π) × (1/n).<br><br>
                <strong>Step 3:</strong> We sum all the scaled harmonics together.
            </p>
        </div>
    </div>

    <script>
        const harmonicsCanvas = document.getElementById('harmonicsCanvas');
        const scaledCanvas = document.getElementById('scaledCanvas');
        const mainCanvas = document.getElementById('mainCanvas');
        const harmonicsCtx = harmonicsCanvas.getContext('2d');
        const scaledCtx = scaledCanvas.getContext('2d');
        const mainCtx = mainCanvas.getContext('2d');
        
        const harmonicsSlider = document.getElementById('harmonicsSlider');
        const harmonicsValue = document.getElementById('harmonicsValue');
        const showTargetCheckbox = document.getElementById('showTarget');
        const showGridCheckbox = document.getElementById('showGrid');
        const harmonicsList = document.getElementById('harmonicsList');
        const equation = document.getElementById('equation');
        
        // Colors for different harmonics
        const colors = [
            '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
            '#DDA0DD', '#98D8C8', '#F7DC6F', '#85C1E2', '#F8B739'
        ];
        
        // Set canvas sizes
        function resizeCanvases() {
            const canvases = [harmonicsCanvas, scaledCanvas, mainCanvas];
            canvases.forEach(canvas => {
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * window.devicePixelRatio;
                canvas.height = rect.height * window.devicePixelRatio;
                const ctx = canvas.getContext('2d');
                ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            });
        }
        
        resizeCanvases();
        window.addEventListener('resize', resizeCanvases);
        
        // Update equation display
        function updateEquation() {
            const numHarmonics = parseInt(harmonicsSlider.value);
            let eqText = 'f(x) = (4/π) × [';
            for (let i = 1; i <= numHarmonics; i++) {
                const n = 2 * i - 1;
                if (i > 1) eqText += ' + ';
                eqText += `(1/${n})sin(${n}x)`;
            }
            eqText += ']';
            equation.textContent = eqText;
        }
        
        // Update harmonics display
        function updateHarmonicsList() {
            const numHarmonics = parseInt(harmonicsSlider.value);
            harmonicsList.innerHTML = '';
            
            for (let i = 1; i <= numHarmonics; i++) {
                const n = 2 * i - 1;
                const amplitude = 4 / (Math.PI * n);
                
                const item = document.createElement('div');
                item.className = 'harmonic-item';
                item.style.background = `linear-gradient(135deg, ${colors[(i-1) % colors.length]}22, ${colors[(i-1) % colors.length]}44)`;
                item.innerHTML = `
                    <span class="harmonic-label">n=${n}</span>
                    <span class="harmonic-amplitude">${amplitude.toFixed(4)}</span>
                `;
                harmonicsList.appendChild(item);
            }
        }
        
        // Draw grid and axes
        function drawGrid(ctx, width, height) {
            if (!showGridCheckbox.checked) return;
            
            // Grid
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 0.5;
            
            // Vertical lines
            for (let x = 0; x <= width; x += width / 8) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            
            // Horizontal lines
            for (let y = 0; y <= height; y += height / 4) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }
            
            // Axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1.5;
            
            // X-axis (at center)
            ctx.beginPath();
            ctx.moveTo(0, height / 2);
            ctx.lineTo(width, height / 2);
            ctx.stroke();
            
            // Y-axis (at center)
            ctx.beginPath();
            ctx.moveTo(width / 2, 0);
            ctx.lineTo(width / 2, height);
            ctx.stroke();
        }
        
        // Draw square wave
        function drawSquareWave(ctx, width, height) {
            ctx.strokeStyle = '#4ECDC4';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            
            for (let px = 0; px <= width; px++) {
                const x = ((px - width/2) / width) * 4 * Math.PI;
                
                // Proper odd square wave: +1 for 0 to π, -1 for π to 2π, etc.
                // Normalize x to [0, 2π] range for the modulo operation
                const normalizedX = ((x % (2 * Math.PI)) + (2 * Math.PI)) % (2 * Math.PI);
                const y = normalizedX < Math.PI ? 1 : -1;
                
                const plotY = height / 2 - y * height * 0.3;
                
                if (px === 0) {
                    ctx.moveTo(px, plotY);
                } else {
                    ctx.lineTo(px, plotY);
                }
            }
            ctx.stroke();
            ctx.setLineDash([]);
        }
        
        // Draw harmonics (unit amplitude)
        function drawUnitHarmonics() {
            const width = harmonicsCanvas.width / window.devicePixelRatio;
            const height = harmonicsCanvas.height / window.devicePixelRatio;
            const numHarmonics = parseInt(harmonicsSlider.value);
            
            harmonicsCtx.clearRect(0, 0, width, height);
            drawGrid(harmonicsCtx, width, height);
            
            // Draw each harmonic with unit amplitude
            for (let h = 1; h <= numHarmonics; h++) {
                const n = 2 * h - 1;
                harmonicsCtx.strokeStyle = colors[(h-1) % colors.length];
                harmonicsCtx.lineWidth = 2;
                harmonicsCtx.globalAlpha = 0.7;
                harmonicsCtx.beginPath();
                
                for (let px = 0; px <= width; px++) {
                    const x = ((px - width/2) / width) * 4 * Math.PI;
                    const y = Math.sin(n * x);
                    const plotY = height / 2 - y * height * 0.3;
                    
                    if (px === 0) {
                        harmonicsCtx.moveTo(px, plotY);
                    } else {
                        harmonicsCtx.lineTo(px, plotY);
                    }
                }
                harmonicsCtx.stroke();
            }
            harmonicsCtx.globalAlpha = 1;
        }
        
        // Draw scaled harmonics
        function drawScaledHarmonics() {
            const width = scaledCanvas.width / window.devicePixelRatio;
            const height = scaledCanvas.height / window.devicePixelRatio;
            const numHarmonics = parseInt(harmonicsSlider.value);
            
            scaledCtx.clearRect(0, 0, width, height);
            drawGrid(scaledCtx, width, height);
            
            // Draw each harmonic scaled by its coefficient
            for (let h = 1; h <= numHarmonics; h++) {
                const n = 2 * h - 1;
                const amplitude = 4 / (Math.PI * n);
                scaledCtx.strokeStyle = colors[(h-1) % colors.length];
                scaledCtx.lineWidth = 2;
                scaledCtx.globalAlpha = 0.7;
                scaledCtx.beginPath();
                
                for (let px = 0; px <= width; px++) {
                    const x = ((px - width/2) / width) * 4 * Math.PI;
                    const y = amplitude * Math.sin(n * x);
                    const plotY = height / 2 - y * height * 0.3;
                    
                    if (px === 0) {
                        scaledCtx.moveTo(px, plotY);
                    } else {
                        scaledCtx.lineTo(px, plotY);
                    }
                }
                scaledCtx.stroke();
            }
            scaledCtx.globalAlpha = 1;
        }
        
        // Draw main visualization
        function drawMain() {
            const width = mainCanvas.width / window.devicePixelRatio;
            const height = mainCanvas.height / window.devicePixelRatio;
            const numHarmonics = parseInt(harmonicsSlider.value);
            
            mainCtx.clearRect(0, 0, width, height);
            drawGrid(mainCtx, width, height);
            
            // Draw target square wave
            if (showTargetCheckbox.checked) {
                drawSquareWave(mainCtx, width, height);
            }
            
            // Draw individual scaled components (faintly)
            for (let h = 1; h <= numHarmonics; h++) {
                const n = 2 * h - 1;
                const amplitude = 4 / (Math.PI * n);
                mainCtx.strokeStyle = 'rgba(150, 150, 150, 0.2)';
                mainCtx.lineWidth = 1;
                mainCtx.beginPath();
                
                for (let px = 0; px <= width; px++) {
                    const x = ((px - width/2) / width) * 4 * Math.PI;
                    const y = amplitude * Math.sin(n * x);
                    const plotY = height / 2 - y * height * 0.3;
                    
                    if (px === 0) {
                        mainCtx.moveTo(px, plotY);
                    } else {
                        mainCtx.lineTo(px, plotY);
                    }
                }
                mainCtx.stroke();
            }
            
            // Draw Fourier sum
            mainCtx.strokeStyle = '#FF6B6B';
            mainCtx.lineWidth = 3;
            mainCtx.beginPath();
            
            for (let px = 0; px <= width; px++) {
                const x = ((px - width/2) / width) * 4 * Math.PI;
                let sum = 0;
                
                for (let h = 1; h <= numHarmonics; h++) {
                    const n = 2 * h - 1;
                    sum += (4 / (Math.PI * n)) * Math.sin(n * x);
                }
                
                const plotY = height / 2 - sum * height * 0.3;
                
                if (px === 0) {
                    mainCtx.moveTo(px, plotY);
                } else {
                    mainCtx.lineTo(px, plotY);
                }
            }
            mainCtx.stroke();
        }
        
        // Update all visualizations
        function updateAll() {
            updateEquation();
            updateHarmonicsList();
            drawUnitHarmonics();
            drawScaledHarmonics();
            drawMain();
        }
        
        // Event listeners
        harmonicsSlider.addEventListener('input', (e) => {
            harmonicsValue.textContent = e.target.value;
            updateAll();
        });
        
        showTargetCheckbox.addEventListener('change', updateAll);
        showGridCheckbox.addEventListener('change', updateAll);
        
        // Initialize
        updateAll();
    </script>
</body>
</html>