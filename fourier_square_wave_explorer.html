<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fourier Series Square Wave Approximation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0f172a;
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
        }
        
        .control-panel {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider-label {
            font-size: 14px;
            color: #94a3b8;
            min-width: 120px;
        }
        
        .slider {
            width: 200px;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(148, 163, 184, 0.2);
            border-radius: 3px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .slider::-webkit-slider-thumb:hover {
            background: #60a5fa;
        }
        
        .slider-value {
            font-size: 16px;
            font-weight: 600;
            color: #f1f5f9;
            min-width: 40px;
            text-align: center;
        }
        
        .equation-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #60a5fa;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 8px;
            padding: 10px 20px;
            overflow-x: auto;
            /* allow wrapping so long equations don't run off the page */
            white-space: normal;
            word-break: break-word;
        }

        .equation-container .sum {
            font-family: 'Courier New', monospace;
            color: #60a5fa;
        }
        
        .plots-container {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            min-height: 0;
        }
        
        .plot-wrapper {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .plot-title {
            font-size: 16px;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .canvas-container {
            flex: 1;
            position: relative;
            min-height: 0;
        }
        
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            font-size: 12px;
            justify-content: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .legend-color {
            width: 16px;
            height: 3px;
            border-radius: 1px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <div class="control-panel">
                <div class="slider-container">
                    <span class="slider-label">Number of terms (n):</span>
                    <input type="range" class="slider" id="nTerms" min="1" max="10" value="5">
                    <span class="slider-value" id="nValue">5</span>
                </div>
                <div class="equation-container" id="equation">
                    f(x) = 4/π · [sin(x) + sin(3x)/3 + sin(5x)/5 + ...]
                </div>
            </div>
            
            <div class="plots-container">
                <div class="plot-wrapper">
                    <div class="plot-title">Individual Fourier Components</div>
                    <div class="canvas-container">
                        <canvas id="componentsCanvas"></canvas>
                    </div>
                </div>
                
                <div class="plot-wrapper">
                    <div class="plot-title">Fourier Series Approximation</div>
                    <div class="canvas-container">
                        <canvas id="approximationCanvas"></canvas>
                    </div>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f472b6;"></div>
                            <span>Square Wave</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #60a5fa;"></div>
                            <span>Fourier Approximation</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const componentsCanvas = document.getElementById('componentsCanvas');
        const approximationCanvas = document.getElementById('approximationCanvas');
        const nSlider = document.getElementById('nTerms');
        const nValueDisplay = document.getElementById('nValue');
        const equationDisplay = document.getElementById('equation');
        
        let nTerms = 5;
        
        // Set up canvases
        function setupCanvas(canvas) {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            const ctx = canvas.getContext('2d');
            ctx.imageSmoothingEnabled = true;
            return ctx;
        }
        
        // Generate equation string (use compact summation when n > 5)
        function generateEquation(n) {
            if (n > 5) {
                // Use simple HTML with sub/sup for readability (no LaTeX engine required)
                return `f(x) = 4/π · <span class="sum">Σ<sub>i=1</sub><sup>${n}</sup> sin((2i-1)x)/(2i-1)</span>`;
            }

            let terms = [];
            for (let i = 1; i <= n; i++) {
                const k = 2 * i - 1;
                if (i === 1) {
                    terms.push(`sin(${k}x)`);
                } else {
                    terms.push(`sin(${k}x)/${k}`);
                }
            }
            // return plain text for expanded form
            return `f(x) = 4/π · [${terms.join(' + ')}]`;
        }
        
        // Square wave function
        function squareWave(x) {
            const period = 2 * Math.PI;
            const normalizedX = ((x % period) + period) % period;
            return normalizedX < Math.PI ? 1 : -1;
        }
        
        // Fourier series approximation
        function fourierApproximation(x, n) {
            let sum = 0;
            for (let i = 1; i <= n; i++) {
                const k = 2 * i - 1;
                sum += Math.sin(k * x) / k;
            }
            return (4 / Math.PI) * sum;
        }
        
        // Draw axes
        function drawAxes(ctx, width, height, padding, yMin, yMax) {
            ctx.strokeStyle = 'rgba(148, 163, 184, 0.3)';
            ctx.lineWidth = 1;
            
            // X-axis
            const yZero = height - padding - ((0 - yMin) / (yMax - yMin)) * (height - 2 * padding);
            ctx.beginPath();
            ctx.moveTo(padding, yZero);
            ctx.lineTo(width - padding, yZero);
            ctx.stroke();
            
            // Y-axis
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            
            // Y-axis labels
            ctx.fillStyle = '#94a3b8';
            ctx.font = '11px sans-serif';
            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            
            const ySteps = 5;
            for (let i = 0; i <= ySteps; i++) {
                const y = padding + i * (height - 2 * padding) / ySteps;
                const value = yMax - i * (yMax - yMin) / ySteps;
                ctx.fillText(value.toFixed(1), padding - 10, y);
                
                // Grid lines
                ctx.strokeStyle = 'rgba(148, 163, 184, 0.1)';
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // X-axis labels
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            const xLabels = ['0', 'π', '2π', '3π', '4π'];
            const xPositions = [0, Math.PI, 2 * Math.PI, 3 * Math.PI, 4 * Math.PI];
            
            for (let i = 0; i < xLabels.length; i++) {
                const x = padding + (xPositions[i] / (4 * Math.PI)) * (width - 2 * padding);
                ctx.fillText(xLabels[i], x, height - padding + 10);
            }
        }
        
        // Draw individual components
        function drawComponents() {
            const ctx = setupCanvas(componentsCanvas);
            const width = componentsCanvas.width;
            const height = componentsCanvas.height;
            const padding = 50;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw axes
            drawAxes(ctx, width, height, padding, -1.5, 1.5);
            
            // Draw each component
            const colors = ['#60a5fa', '#34d399', '#f472b6', '#fbbf24', '#a78bfa'];
            const xMin = 0;
            const xMax = 4 * Math.PI;
            const steps = 500;
            
            for (let n = 1; n <= nTerms; n++) {
                const k = 2 * n - 1;
                ctx.strokeStyle = colors[(n - 1) % colors.length];
                ctx.lineWidth = 2;
                ctx.globalAlpha = 0.8;
                ctx.beginPath();
                
                for (let i = 0; i <= steps; i++) {
                    const x = xMin + (i / steps) * (xMax - xMin);
                    const y = (4 / Math.PI) * Math.sin(k * x) / k;
                    const pixelX = padding + (i / steps) * (width - 2 * padding);
                    const pixelY = height - padding - ((y + 1.5) / 3) * (height - 2 * padding);
                    
                    if (i === 0) {
                        ctx.moveTo(pixelX, pixelY);
                    } else {
                        ctx.lineTo(pixelX, pixelY);
                    }
                }
                
                ctx.stroke();
            }
            
            ctx.globalAlpha = 1;
        }
        
        // Draw approximation
        function drawApproximation() {
            const ctx = setupCanvas(approximationCanvas);
            const width = approximationCanvas.width;
            const height = approximationCanvas.height;
            const padding = 50;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw axes
            drawAxes(ctx, width, height, padding, -1.5, 1.5);
            
            const xMin = 0;
            const xMax = 4 * Math.PI;
            const steps = 500;
            
            // Draw square wave
            ctx.strokeStyle = '#f472b6';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            for (let i = 0; i <= steps; i++) {
                const x = xMin + (i / steps) * (xMax - xMin);
                const y = squareWave(x);
                const pixelX = padding + (i / steps) * (width - 2 * padding);
                const pixelY = height - padding - ((y + 1.5) / 3) * (height - 2 * padding);
                
                if (i === 0) {
                    ctx.moveTo(pixelX, pixelY);
                } else {
                    ctx.lineTo(pixelX, pixelY);
                }
            }
            
            ctx.stroke();
            
            // Draw Fourier approximation
            ctx.strokeStyle = '#60a5fa';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i <= steps; i++) {
                const x = xMin + (i / steps) * (xMax - xMin);
                const y = fourierApproximation(x, nTerms);
                const pixelX = padding + (i / steps) * (width - 2 * padding);
                const pixelY = height - padding - ((y + 1.5) / 3) * (height - 2 * padding);
                
                if (i === 0) {
                    ctx.moveTo(pixelX, pixelY);
                } else {
                    ctx.lineTo(pixelX, pixelY);
                }
            }
            
            ctx.stroke();
        }
        
        // Update visualization
        function updateVisualization() {
            nTerms = parseInt(nSlider.value);
            nValueDisplay.textContent = nTerms;
            // render the equation (use innerHTML because generateEquation may return HTML)
            const eq = generateEquation(nTerms);
            equationDisplay.innerHTML = eq;
            drawComponents();
            drawApproximation();
        }
        
        // Event listeners
        nSlider.addEventListener('input', updateVisualization);
        
        // Handle window resize
        window.addEventListener('resize', () => {
            updateVisualization();
        });
        
        // Initial draw
        setTimeout(updateVisualization, 100);
    </script>
</body>
</html>